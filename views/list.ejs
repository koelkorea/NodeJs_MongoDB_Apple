<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/main.css" rel="stylesheet">
    <title>Document</title>
</head>
<body class="grey-bg">

    <!-- include(íŒŒì¼ìœ„ì¹˜)ë¥¼ í†µí•´, jsë¥¼ ë¶™ì¼ ìˆ˜ ìˆìŒ -->
    <%- include('nav.ejs') %>

    <input class="search">
    <button class="search-send">ê²€ìƒ‰</button> 

    <div class="white-bg">

    <!-- ë°˜ë³µë¬¸ì„ í†µí•´ jsë³€ìˆ˜ ë‚´ë¶€ ê°ì²´ë°°ì—´ì˜ ê°’ì„ ë°˜ë³µí•´ì„œ ë§Œë“¤ì–´ ë‚¸ HTML íƒœê·¸ -->
    <% for (var i = 0; i < ê¸€ëª©ë¡.length; i++){ %>

        <div class="white-box">
            <div class="list-box">
                <!-- í…œí”Œë¦¿ ê¸°í˜¸ëŠ” ""ì•ˆì—ì„œë„ ì¸ì‹ë˜ë©°, ë§í¬ë¥¼ ë§Œë“¤ìˆ˜ ìˆê²Œ í•¨ -->
                <a href="/board/detail/<%= ê¸€ëª©ë¡[i]._id %>">
                    <h4><%= ê¸€ëª©ë¡[i].title %></h4>
                </a>
                <p><%= ê¸€ëª©ë¡[i].content %></p>
                <!-- ìˆ˜ì •í™”ë©´ ì´ë™ ë²„íŠ¼ -->
                <a href="/board/edit/<%= ê¸€ëª©ë¡[i]._id %>">âœï¸</a>
                <!-- ì‚­ì œê¸°ëŠ¥ ìˆ˜í–‰ ë²„íŠ¼ -->
                <span class="delete1">ğŸ—‘ï¸</span>
                <span class="delete2" data-id="<%= ê¸€ëª©ë¡[i]._id %>" data-row="<%= i %>">ğŸ—‘ï¸</span>
            </div>
        </div>
        
    <% } %> 

        <!-- ë™ê¸°ì  ì´ì „ ë‹¤ìŒ êµ¬í˜„ì„ ìœ„í•¨-->
        <div class="white-box">

        <% if ( ( (í˜ì´ì§€ * 1) != 1 ) || (ê°¯ìˆ˜ == 0) ) { %>
            <a href="/board/list/paging/ver1/<%= parseInt(í˜ì´ì§€) - 1 %>">ì´ì „(db í˜ì´ì§• ì²˜ë¦¬)</a>
        <% } %> 

        <% for (var j = 1; j <= Math.trunc(ê°¯ìˆ˜ / 5) + 1; j++){ %>
            <a href="/board/list/paging/ver1/<%=j%>"> <%= j %> </a>
        <% } %> 

        <% if ( ( (í˜ì´ì§€ * 1) != Math.trunc(ê°¯ìˆ˜ / 5) + 1 ) || (ê°¯ìˆ˜ == 0) ) { %>
            <a href="/board/list/paging/ver1/<%= parseInt(í˜ì´ì§€) + 1 %>">ë‹¤ìŒ(db í˜ì´ì§• ì²˜ë¦¬)</a>
        <% } %> 

        </div>
    
        </br>

        <!-- ë™ê¸°ì  ì´ì „ ë‹¤ìŒ êµ¬í˜„ì„ ìœ„í•¨-->
        <div class="white-box">


        <% if ( (í˜ì´ì§€ * 1) != 1 ){ %>
            <a href="/board/list/paging/ver2/<%= parseInt(í˜ì´ì§€) - 1 %>">ì´ì „(ì›¹ì„œë²„ í˜ì´ì§• ì²˜ë¦¬)</a>
        <% } %> 

        <% for (var j = 1; j <= Math.trunc(ê°¯ìˆ˜ / 5) + 1; j++){ %>
            <a href="/board/list/paging/ver2/<%=j%>"> <%= j %> </a>
        <% } %> 

        <% if ( (í˜ì´ì§€ * 1) != Math.trunc(ê°¯ìˆ˜ / 5) + 1 ){ %>
            <a href="/board/list/paging/ver2/<%= parseInt(í˜ì´ì§€) + 1 %>">ë‹¤ìŒ(ì›¹ì„œë²„ í˜ì´ì§• ì²˜ë¦¬)</a>
        <% } %> 

        </div>
    </div> 
    <div style="text-align: center"> 
        <!-- <%= JSON.stringify(ê¸€ëª©ë¡) %> -->
        <%= ë‚ ì§œ %>
    </div> 
</body>
<script>

    // ë¦¬ìŠ¤íŠ¸ ê²€ìƒ‰ê¸°ëŠ¥ êµ¬í˜„
    document.querySelector('.search-send').addEventListener('click', function(){
        let ì…ë ¥í•œê±° = document.querySelector('.search').value

        // (window).location.href : windowê°ì²´ì˜ ë¸Œë¼ìš°ì €ì˜ ìš”ì†Œë¥¼ êµ¬ì„±í•˜ëŠ” ê°ì²´ë¡œ, aíƒœê·¸ì˜ hrefì†ì„±ì˜ ê·¸ê²ƒê³¼ ê°™ì´ í˜„ì¬ ìœ„ì¹˜í•˜ëŠ” url ì£¼ì†Œë¥¼ ë„ì–´ì¤Œ
        //   -> aíƒœê·¸ë¥¼ í´ë¦­ì‹œ ì¼ì–´ë‚˜ëŠ” ê·¸ê²ƒë„ ì´ì™€ ê°™ì€ ë…€ì„
        //   -> ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í†µí•´ ë³€ê²½ë„ ê°€ëŠ¥í•¨
        //   -> (ì¤‘ìš”) [ë‹¨ì 1] ì´ë¥¼ í†µí•´ì„œëŠ” GETë°©ì‹ì˜ í˜¸ì¶œ ë°–ì— í•  ìˆ˜ ì—†ìŒ
        //   -> (ì¤‘ìš”) [ë‹¨ì 2] ë°˜ë“œì‹œ ìƒˆë¡œê³ ì¹¨ì´ ì¼ì–´ë‚˜ëŠ” ë°©ì‹ì„
        location.href = '/search?val=' + ì…ë ¥í•œê±°
    })

    <% for (var i = 0; i < ê¸€ëª©ë¡.length; i++){ %>

            // ì‚­ì œê¸°ëŠ¥ êµ¬í˜„1) FORMíƒœê·¸ ì—†ì´ ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆë¥¼ í†µí•œ í´ë¦­ì‹œ, ì´ë¥¼ QueryString ë°©ì‹ìœ¼ë¡œ ì„œë²„ APIí˜¸ì¶œí•˜ì—¬ êµ¬í˜„ + then, catch, finally ì‚¬ìš©í•˜ì—¬ DOMêµ¬ì¡° ì¡°ì‘ê¹Œì§€ í•´ë³´ê¸°
            document.querySelectorAll('.delete1')[<%= i %>].addEventListener('click', function(){
                if( confirm('1ë²ˆì§¸ ë°©ì‹ìœ¼ë¡œ ì‚­ì œí• ê¹Œìš”?') ){
                    fetch(`/board/delete?id=<%= ê¸€ëª©ë¡[i]._id %>`,  { method : 'DELETE' })
                    .then( (ì‘ë‹µ) => ì‘ë‹µ.text() )
                    .then( (ì‘ë‹µ) => {
                        document.querySelectorAll('.delete1')[<%= i %>].parentElement.style.display = 'none'
                    })
                }
            });

            // ì‚­ì œê¸°ëŠ¥ êµ¬í˜„2) êµ¬í˜„1ì— HTMLì˜ data ì†ì„±ì„ ì´ìš©í•˜ì—¬ ë§Œë“¤ì–´ì§„ dataset ê°ì²´ë¥¼ í†µí•´ ê°’ì„ ê°€ì ¸ì˜¨ ë’¤, ì´ë¥¼ QueryString ë°©ì‹ìœ¼ë¡œ ì„œë²„ APIí˜¸ì¶œí•˜ì—¬ êµ¬í˜„ + async await ì‚¬ìš©í•˜ì—¬ DOMêµ¬ì¡° ì¡°ì‘ê¹Œì§€ í•´ë³´ê¸°
            document.querySelectorAll('.delete2')[<%= i %>].addEventListener('click', async function(e){
                if( confirm('2ë²ˆì§¸ ë°©ì‹ìœ¼ë¡œ ì‚­ì œí• ê¹Œìš”?') ){

                    // (ì¤‘ìš”!) awaitê°€ ë¶™ìœ¼ë©´, í•´ë‹¹ í•¨ìˆ˜ {}ì•ˆì˜ í•´ë‹¹ ë¹„ë™ê¸°ì½”ë“œê°€ ì‘ë‹µì´ ëŒì•„ì˜¬ë–„ê¹Œì§€ ì´ë¥¼ ê¸°ë‹¤ë ¤ì¤Œ
                    //  -> ê·¸ëŸ° ì˜ë¯¸ì—ì„œ fetchë¥¼ í†µí•œ API í˜¸ì¶œì€ async awaitë¥¼ ì‚¬ìš©ì‹œ ë°˜ë“œì‹œ awaitë¥¼ ë¶™ì—¬ì¤˜ì•¼í•¨.. ê·¸ë˜ì•¼ fetchê°€ ëë‚ ë–„ê¹Œì§€ ê¸°ë‹¤ë ¤ì¤Œ 
                    let result = await fetch('/board/delete?id=' + e.target.dataset.id, { method : 'DELETE' });
                    let response = await result.text();
                    e.target.parentElement.style.display = 'none';
                }
            });
    <% } %> 

</script>
</html>