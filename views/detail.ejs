<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/main.css" rel="stylesheet">
    <title>Document</title>
</head>
<body>

    <!-- include(파일위치)를 통해, js를 붙일 수 있음 -->
    <%- include('nav.ejs') %>
    
    <div class="detail-bg">
        <h4><%= 상세글.title %></h4>
        <p><%= 상세글.content %></p>

        <!-- img 멤버변수 안의 내용물이 배열인지 여부에 따라 반복문 처리여부를 선택 -->
        <%  if( Array.isArray(상세글.img) ){
                <!-- 반복문을 통해 js변수 내부 객체배열의 값을 반복해서 만들어 낸 HTML 태그 -->
                for (var i = 0; i < 상세글.img.length; i++){ %>
                    <img src="<%= 상세글.img[i]%>">
        <%      } 
            } else { %>     

                <img src="<%= 상세글.img %>">
        <%  } %>   

        <!-- DB의 덧글 LIST들 -->
        <hr style="margin-top: 60px">
        <% for (let i = 0; i < 댓글.length; i++) { %>
            <p><strong><%= 댓글[i].writer %></strong> <%= 댓글[i].content %></p>
        <% } %> 

        <!-- 덧글1. form 태그 형식으로 구현 -->
        <hr>
        <div>
            <p><strong>작성자</strong> 댓글내용</p>
        </div>
        <form action="/comment/write/ver1" method="POST">
            <input name="content">
            <input name="parentId" value="<%= 상세글._id %>" style="display: none">
            <button type="submit">댓글작성(form태그)</button>
            <button class="ajax">댓글작성(ajax)</button>
        </form>

        <!-- (과제) 덧글2. AJAX 형식으로 비동기 업뎃이 되도록 구현해봐라 -->
    </div> 
</body>
<script>

    // 삭제기능 구현2) 구현1에 HTML의 data 속성을 이용하여 만들어진 dataset 객체를 통해 값을 가져온 뒤, 이를 QueryString 방식으로 서버 API호출하여 구현 + async await 사용하여 DOM구조 조작까지 해보기
    document.querySelector('.ajax').addEventListener('click', async function(e){

        // (중요!) await가 붙으면, 해당 함수 {}안의 해당 비동기코드가 응답이 돌아올떄까지 이를 기다려줌
        //  -> 그런 의미에서 fetch를 통한 API 호출은 async await를 사용시 반드시 await를 붙여줘야함.. 그래야 fetch가 끝날떄까지 기다려줌 
        let result = await fetch('/comment/write/ver2', { method : 'POST' });
        let response = await result.;

        // 쓴 덧글 바로 화면에 띄워주기 완성해보기

    });

</script>
</html>