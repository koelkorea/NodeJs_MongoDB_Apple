<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="/main.css" rel="stylesheet">
    <title>Document</title>
</head>
<body class="grey-bg">

    <!-- include(íŒŒì¼ìœ„ì¹˜)ë¥¼ í†µí•´, jsë¥¼ ë¶™ì¼ ìˆ˜ ìˆìŒ -->
    <%- include('nav.ejs') %>

    <input class="search" value="<%= ê²€ìƒ‰ì–´ %>">
    <button class="search-send regex">ê²€ìƒ‰(ì •ê·œì‹)</button> 
    <button class="search-send text_index">ê²€ìƒ‰(text Index)</button> 
    <button class="search-send search_index">ê²€ìƒ‰(search Index)</button> 

    <div class="white-bg">

    <!-- ë°˜ë³µë¬¸ì„ í†µí•´ jsë³€ìˆ˜ ë‚´ë¶€ ê°ì²´ë°°ì—´ì˜ ê°’ì„ ë°˜ë³µí•´ì„œ ë§Œë“¤ì–´ ë‚¸ HTML íƒœê·¸ -->
    <% for (var i = 0; i < ê¸€ëª©ë¡.length; i++){ %>

        <div class="white-box">
            <div class="list-box">
                <p>id : <%= ê¸€ëª©ë¡[i].username %> </p>
                <!-- í…œí”Œë¦¿ ê¸°í˜¸ëŠ” ""ì•ˆì—ì„œë„ ì¸ì‹ë˜ë©°, ë§í¬ë¥¼ ë§Œë“¤ìˆ˜ ìˆê²Œ í•¨ -->
                <a href="/board/detail/<%= ê¸€ëª©ë¡[i]._id %>">
                    <h4><%= ê¸€ëª©ë¡[i].title %></h4>
                </a>
                <p><%= ê¸€ëª©ë¡[i].content %></p>
                <!-- ìˆ˜ì •í™”ë©´ ì´ë™ ë²„íŠ¼ -->
                <a href="/board/edit/<%= ê¸€ëª©ë¡[i]._id %>">âœï¸</a>
                <!-- ì‚­ì œê¸°ëŠ¥ ìˆ˜í–‰ ë²„íŠ¼ -->
                <span class="delete1">ğŸ—‘ï¸</span>
                <span class="delete2" data-id="<%= ê¸€ëª©ë¡[i]._id %>" data-row="<%= i %>">ğŸ—‘ï¸</span>
            </div>
        </div>
        
    <% } %> 

        <!-- ì •ê·œì‹ -->
        <div class="white-box">
            [ì •ê·œì‹]</br>
            <% if ( ( (í˜ì´ì§€ * 1) != 1 ) || (ê°¯ìˆ˜ == 0) ) { %>
                <a href="/board/search/ver1/<%= parseInt(í˜ì´ì§€) - 1 %>?val=<%= ê²€ìƒ‰ì–´ %>">ì´ì „(ì •ê·œì‹)</a>
            <% } %> 
    
            <% for (var j = 1; j <= Math.trunc( (ê°¯ìˆ˜ - 1) / 5) + 1; j++){ %>
                <a href="/board/search/ver1/<%=j%>?val=<%= ê²€ìƒ‰ì–´ %>"> <%= j %> </a>
            <% } %> 
    
            <% if ( ( (í˜ì´ì§€ * 1) != Math.trunc( (ê°¯ìˆ˜ - 1) / 5) + 1 ) || (ê°¯ìˆ˜ == 0) ) { %>
                <a href="/board/search/ver1/<%= parseInt(í˜ì´ì§€) + 1 %>?val=<%= ê²€ìƒ‰ì–´ %>">ë‹¤ìŒ(ì •ê·œì‹)</a>
            <% } %> 
    
        </div>
    
        </br>

        <!-- text index -->
        <div class="white-box">
            [text index]</br>
            <% if ( ( (í˜ì´ì§€ * 1) != 1 ) || (ê°¯ìˆ˜ == 0) ) { %>
                <a href="/board/search/ver2/<%= parseInt(í˜ì´ì§€) - 1 %>?val=<%= ê²€ìƒ‰ì–´ %>">ì´ì „(text index)</a>
            <% } %> 
    
            <% for (var j = 1; j <= Math.trunc( (ê°¯ìˆ˜ - 1) / 5) + 1; j++){ %>
                <a href="/board/search/ver2/<%=j%>?val=<%= ê²€ìƒ‰ì–´ %>"> <%= j %> </a>
            <% } %> 
    
            <% if ( ( (í˜ì´ì§€ * 1) != Math.trunc( (ê°¯ìˆ˜ - 1) / 5) + 1 ) || (ê°¯ìˆ˜ == 0) ) { %>
                <a href="/board/search/ver2/<%= parseInt(í˜ì´ì§€) + 1 %>?val=<%= ê²€ìƒ‰ì–´ %>">ë‹¤ìŒ(text index)</a>
            <% } %> 
    
        </div>
    
        </br>

        <!-- search index -->
        <div class="white-box">
            [search index]</br>
            <% if ( (í˜ì´ì§€ * 1) != 1 ){ %>
                <a href="/board/search/ver3/<%= parseInt(í˜ì´ì§€) - 1 %>?val=<%= ê²€ìƒ‰ì–´ %>">ì´ì „(search index)</a>
            <% } %> 
    
            <% for (var j = 1; j <= Math.trunc( (ê°¯ìˆ˜ - 1) / 5) + 1; j++){ %>
                <a href="/board/search/ver3/<%=j%>?val=<%= ê²€ìƒ‰ì–´ %>"> <%= j %> </a>
            <% } %> 
    
            <% if ( (í˜ì´ì§€ * 1) != Math.trunc( (ê°¯ìˆ˜ - 1) / 5) + 1 ){ %>
                <a href="/board/search/ver3/<%= parseInt(í˜ì´ì§€) + 1 %>?val=<%= ê²€ìƒ‰ì–´ %>">ë‹¤ìŒ(search index)</a>
            <% } %> 

        </div>

    </div>
    
    <div style="text-align: center"> 
        <button class="delete_all_document">ëª¨ë“  ë°ì´í„° ì‚­ì œ</button> 
        <!-- <%= JSON.stringify(ê¸€ëª©ë¡) %> -->
        <%= ë‚ ì§œ %>
    </div> 
</body>
<script>

    // ë¦¬ìŠ¤íŠ¸ ê²€ìƒ‰ê¸°ëŠ¥ êµ¬í˜„1 : ì •ê·œì‹ ì‚¬ìš©
    document.querySelector('.regex').addEventListener('click', function(){
        let ì…ë ¥í•œê±° = document.querySelector('.search').value

        // (window).location.href : windowê°ì²´ì˜ ë¸Œë¼ìš°ì €ì˜ ìš”ì†Œë¥¼ êµ¬ì„±í•˜ëŠ” ê°ì²´ë¡œ, aíƒœê·¸ì˜ hrefì†ì„±ì˜ ê·¸ê²ƒê³¼ ê°™ì´ í˜„ì¬ ìœ„ì¹˜í•˜ëŠ” url ì£¼ì†Œë¥¼ ë„ì–´ì¤Œ
        //   -> aíƒœê·¸ë¥¼ í´ë¦­ì‹œ ì¼ì–´ë‚˜ëŠ” ê·¸ê²ƒë„ ì´ì™€ ê°™ì€ ë…€ì„
        //   -> ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ í†µí•´ ë³€ê²½ë„ ê°€ëŠ¥í•¨
        //   -> (ì¤‘ìš”) [ë‹¨ì 1] ì´ë¥¼ í†µí•´ì„œëŠ” GETë°©ì‹ì˜ í˜¸ì¶œ ë°–ì— í•  ìˆ˜ ì—†ìŒ
        //   -> (ì¤‘ìš”) [ë‹¨ì 2] ë°˜ë“œì‹œ ìƒˆë¡œê³ ì¹¨ì´ ì¼ì–´ë‚˜ëŠ” ë°©ì‹ì„
        location.href = '/board/search/ver1/1?val=' + ì…ë ¥í•œê±°
    })

    // ë¦¬ìŠ¤íŠ¸ ê²€ìƒ‰ê¸°ëŠ¥ êµ¬í˜„2 : textê¸°ì¤€ index ì‚¬ìš©
    document.querySelector('.text_index').addEventListener('click', function(){
        let ì…ë ¥í•œê±° = document.querySelector('.search').value
        location.href = '/board/search/ver2/1?val=' + ì…ë ¥í•œê±°
    })

    document.querySelector('.search_index').addEventListener('click', function(){
        let ì…ë ¥í•œê±° = document.querySelector('.search').value
        location.href = '/board/search/ver3/1?val=' + ì…ë ¥í•œê±°
    })

    // ëª¨ë“  ë°ì´í„° ì‚­ì œ
    document.querySelector('.delete_all_document').addEventListener('click', function(){

        if( confirm('ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí• ê¹Œìš”?') ){

            // (ì¤‘ìš”) ë¹„ë™ê¸°ì ìœ¼ë¡œ ì„œë²„ì™€ ë°ì´í„°ë¥¼ êµí™˜í•˜ëŠ” js ê³µì‹ ë°©ì‹ì¸ fetch apië¥¼ ì‚¬ìš©í•  ê²½ìš°, ìƒˆë¡œê³ ì¹¨ì´ ì¼ì–´ë‚˜ì§€ ì•Šìœ¼ë¯€ë¡œ..
            //   -> server.jsì—ì„œ redirectë‚˜ renderë¡œ ë‹¤ë¥¸ í˜ì´ì§€ë¡œ ì´ë™ì‹œí‚¤ëŠ” ì»¤ë§¨ë“œì— ëŒ€í•œ ê²°ì •ì€ í™”ë©´ì˜ fetch ì²´ì´ë‹ ë¡œì§ ì˜ì—­ì—ì„œ ê²°ì •í•¨..
            //      (= API {}ì•ˆì—ì„œ redirect(url)ì„ ì ìœ¼ë©´, ê·¸ê±¸ fetch ì²´ì´ë‹ ë‹¨ê³„ì—ì„œ ì‘ë‹µì˜ ë©¤ë²„ë³€ìˆ˜ ì¤‘ í•˜ë‚˜ì¸ urlì•ˆì— ê°€ì ¸ì˜¤ëŠ”ë°, ì´ê±¸ window.location.hrefë¼ëŠ” windowê°ì²´ì˜ ì†ì„±ê°’ìœ¼ë¡œ ì§ì ‘ ë„£ì–´ì„œ í•´ê²°í•¨)  
            fetch(`/board/delete/all`,  { method : 'DELETE' })
            .then( (ì‘ë‹µ) => {
                ì‘ë‹µ.text();
                console.log(ì‘ë‹µ.url);
                ì‘ë‹µ.redirect(ì‘ë‹µ.url);
                // window.location.href = ì‘ë‹µ.url;
            });

        }
    })
    
    <% for (var i = 0; i < ê¸€ëª©ë¡.length; i++){ %>

            // ì‚­ì œê¸°ëŠ¥ êµ¬í˜„1) FORMíƒœê·¸ ì—†ì´ ì´ë²¤íŠ¸ë¦¬ìŠ¤ë„ˆë¥¼ í†µí•œ í´ë¦­ì‹œ, ì´ë¥¼ QueryString ë°©ì‹ìœ¼ë¡œ ì„œë²„ APIí˜¸ì¶œí•˜ì—¬ êµ¬í˜„ + then, catch, finally ì‚¬ìš©í•˜ì—¬ DOMêµ¬ì¡° ì¡°ì‘ê¹Œì§€ í•´ë³´ê¸°
            document.querySelectorAll('.delete1')[<%= i %>].addEventListener('click', function(){
                if( confirm('1ë²ˆì§¸ ë°©ì‹ìœ¼ë¡œ ì‚­ì œí• ê¹Œìš”?') ){
                    fetch(`/board/delete?id=<%= ê¸€ëª©ë¡[i]._id %>`,  { method : 'DELETE' })
                    .then( (ì‘ë‹µ) => ì‘ë‹µ.text() )
                    .then( (ì‘ë‹µ) => {
                        document.querySelectorAll('.delete1')[<%= i %>].parentElement.style.display = 'none'
                    })
                }
            });

            // ì‚­ì œê¸°ëŠ¥ êµ¬í˜„2) êµ¬í˜„1ì— HTMLì˜ data ì†ì„±ì„ ì´ìš©í•˜ì—¬ ë§Œë“¤ì–´ì§„ dataset ê°ì²´ë¥¼ í†µí•´ ê°’ì„ ê°€ì ¸ì˜¨ ë’¤, ì´ë¥¼ QueryString ë°©ì‹ìœ¼ë¡œ ì„œë²„ APIí˜¸ì¶œí•˜ì—¬ êµ¬í˜„ + async await ì‚¬ìš©í•˜ì—¬ DOMêµ¬ì¡° ì¡°ì‘ê¹Œì§€ í•´ë³´ê¸°
            document.querySelectorAll('.delete2')[<%= i %>].addEventListener('click', async function(e){
                if( confirm('2ë²ˆì§¸ ë°©ì‹ìœ¼ë¡œ ì‚­ì œí• ê¹Œìš”?') ){

                    // (ì¤‘ìš”!) awaitê°€ ë¶™ìœ¼ë©´, í•´ë‹¹ í•¨ìˆ˜ {}ì•ˆì˜ í•´ë‹¹ ë¹„ë™ê¸°ì½”ë“œê°€ ì‘ë‹µì´ ëŒì•„ì˜¬ë–„ê¹Œì§€ ì´ë¥¼ ê¸°ë‹¤ë ¤ì¤Œ
                    //  -> ê·¸ëŸ° ì˜ë¯¸ì—ì„œ fetchë¥¼ í†µí•œ API í˜¸ì¶œì€ async awaitë¥¼ ì‚¬ìš©ì‹œ ë°˜ë“œì‹œ awaitë¥¼ ë¶™ì—¬ì¤˜ì•¼í•¨.. ê·¸ë˜ì•¼ fetchê°€ ëë‚ ë–„ê¹Œì§€ ê¸°ë‹¤ë ¤ì¤Œ 
                    let result = await fetch('/board/delete?id=' + e.target.dataset.id, { method : 'DELETE' });
                    let response = await result.text();
                    e.target.parentElement.style.display = 'none';
                }
            });
    <% } %> 

</script>
</html>