Access 키 발급

 

일단 AWS 사이트 들어가서 가입하고 카드등록까지 마칩시다. 

이제 서버에서 AWS기능을 이용하고 싶으면

서버파일에서 코드짤 때 Access key가 하나 필요합니다. 

그거 발급하려면 AWS 사이트 상단에서 IAM 검색해서 들어갑시다. 

 

 

 

 



 

▲ 아니면 우측 위에 님들 이름눌러도 아마 들어갈 수 있음

 

 

 



 

▲ 1. 좌측에서 사용자를 하나 만들어줍니다.

이게 뭐냐면 님의 AWS 계정에 여러 사람이 접속해서 일할 수도 있기 때문에 

님 AWS 권한을 대신 사용가능한 아이디 하나 새로 만드는 것임 

 

 

 



 

▲ 사용자 이름은 아무렇게나 하고 권한 설정 메뉴에선 

AmazonS3FullAccess 권한을 체크하고 하나 만들어주면 됩니다. 

방금 뭐한거냐면 S3 액세스 권한이 있는 사용자를 하나 만들어준 것임 

 

 

 

 



 

▲ 2. 방금 만든 사용자 눌러보면 

액세스키 만들기가 어딘가 있는데 그거 눌러서 액세스 키 하나 만들어 줍시다.

그럼 액세스키와 비밀키 2개를 발급해주는데 코딩할 때 사용하게 안전한 곳에 보관해둡시다. 

이거 털리면 님들 AWS 요금 월 1억 나옵니다. 

그리고 위 사진에 보면 ARN도 있는데 이것도 필요하니까 복사해둡시다. 

 

 

 

 

 

 

 

 

AWS S3 셋팅

 

S3를 이용하고 싶으면

AWS 사이트 상단에서 S3 검색해서 들어가봅시다.

그리고 어딘가에 있는 버킷만들기 버튼 누르면 됩니다. 

 

 



 

▲ 버킷은 여러분만의 저장공간입니다. 

버킷 이름 작명은 유니크하게 해줍시다.

 

 

 

 

 



 

▲ 퍼블릭 액세스 설정을 이렇게 바꿔줍시다. 그래야 개발시 편합니다. 

대충 이것만 채워서 버킷만들면 됩니다. 

 

 

 

 

 

 

버킷정책 수정하기

 

보안을 신경써야한다면 일반 사람들은 읽기만 가능하게,

관리자는 수정, 삭제가 가능하게 바꾸는게 좋은데 

 

 



 

▲ 방금 만든 버킷 들어가서 권한 눌러서 버킷 정책 부분을 편집해봅시다.

누가 버킷을 읽기, 수정, 삭제 할 수 있는지 정의하는 부분입니다.

 

 

 

 

{
    "Version": "2012-10-17",
    "Statement": [
        {
            "Sid": "1",
            "Effect": "Allow",
            "Principal": "*",
            "Action": "s3:GetObject",
            "Resource": "arn:aws:s3:::님들버킷명/*"
        },
        {
            "Sid": "2",
            "Effect": "Allow",
            "Principal": {
                "AWS": "님들ARN"
            },
            "Action": [
                "s3:PutObject",
                "s3:DeleteObject"
            ],
            "Resource": "arn:aws:s3:::님들버킷명/*"
        }
    ]
} 
 

그래서 이렇게만 써놔도 일단은 안전한데 Sid : 1번은 모든 유저는 GET이 가능하고

2번은 관리자만 PUT, DELETE가 가능하다고 적어놓은 것입니다. 

 

- Actions 항목에서 

자료 읽기는 s3:GetObject

쓰기는 s3:PutObject

삭제는 s3:DeleteObject

를 의미합니다. 

 

- Principal 항목은 어떤 유저인지 명시하는 부분인데 * 쓰면 모든유저, 특정 AWS 계정을 넣고 싶으면 ARN 주소 넣으면 됩니다.

둘째 Principal 항목엔 님들이 액세스 키 발급받았던 그 사용자 계정의 ARN을 넣어줍시다. 

ARN은 까먹었으면 IAM - 사용자 메뉴 들어가서 다시 복사해오면 됩니다. 

 

- Resource는 어떤 버킷인지 버킷명 잘 적어주면 됩니다. 

제 경우는 arn:aws:s3:::codingappleimage1/* 이렇게 적어봄 

 

참고로 버킷 사용권한을 ACL 어쩌구로 설정하는 방법도 있는데 

실은 옛날에 쓰던 방법입니다. 지금은 이런 방식을 권장합니다. 

 

 

 

 

 

 

 

그 밑에 CORS 설정은

 

[
    {
        "AllowedHeaders": [
            "*"
        ],
        "AllowedMethods": [
            "PUT",
            "POST"
        ],
        "AllowedOrigins": [
            "*"
        ],
        "ExposeHeaders": [
            "ETag"
        ]
    }
] 
어떤 사이트에서 버킷안의 파일들을 읽기, 쓰기, 삭제할 수 있는지 CORS 설정하는 부분입니다.

다른 사이트에서 자료 쓰기, 삭제 못하게 만들려면

AllowedOrigins 안에 님들 사이트 주소 넣으면 되는데 개발중이니 * 넣어둡시다. 

 

아무튼 여기까지 하면 버킷에 자유롭게 파일을 올릴 수 있는데

직접 파일을 손으로 드래그해서 올리진 않을 것 아닙니까

서버에서 올릴텐데 서버코드로 올리는 법을 다음 시간에 알아봅시다. 

 

 